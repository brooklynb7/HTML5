/**
 * validate.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */
var Validator={isEmail:function(s){return this.test(s,'^[-!#$%&\'*+\\./0-9=?A-Z^_`a-z{|}~]+@[-!#$%&\'*+\\/0-9=?A-Z^_`a-z{|}~]+\.[-!#$%&\'*+\\./0-9=?A-Z^_`a-z{|}~]+$')},isAbsUrl:function(s){return this.test(s,'^(news|telnet|nttp|file|http|ftp|https)://[-A-Za-z0-9\\.]+\\/?.*$')},isSize:function(s){return this.test(s,'^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)?$')},isId:function(s){return this.test(s,'^[A-Za-z_]([A-Za-z0-9_])*$')},isEmpty:function(s){var n,i;if(s.nodeName=='SELECT'&&s.selectedIndex<1)return true;if(s.type=='checkbox'&&!s.checked)return true;if(s.type=='radio'){for(i=0,n=s.form.elements;i<n.length;i++){if(n[i].type=="radio"&&n[i].name==s.name&&n[i].checked)return false}return true}return new RegExp('^\\s*$').test(s.nodeType==1?s.value:s)},isNumber:function(s,d){return!isNaN(s.nodeType==1?s.value:s)&&(!d||!this.test(s,'^-?[0-9]*\\.[0-9]*$'))},test:function(s,p){s=s.nodeType==1?s.value:s;return s==''||new RegExp(p).test(s)}};var AutoValidator={settings:{id_cls:'id',int_cls:'int',url_cls:'url',number_cls:'number',email_cls:'email',size_cls:'size',required_cls:'required',invalid_cls:'invalid',min_cls:'min',max_cls:'max'},init:function(s){var n;for(n in s)this.settings[n]=s[n]},validate:function(f){var i,n,s=this.settings,c=0;n=this.tags(f,'label');for(i=0;i<n.length;i++){this.removeClass(n[i],s.invalid_cls);n[i].setAttribute('aria-invalid',false)}c+=this.validateElms(f,'input');c+=this.validateElms(f,'select');c+=this.validateElms(f,'textarea');return c==3},invalidate:function(n){this.mark(n.form,n)},getErrorMessages:function(f){var n,i,s=this.settings,c,m,v,d=[],e=tinyMCEPopup.editor;n=this.tags(f,"label");for(i=0;i<n.length;i++){if(this.hasClass(n[i],s.invalid_cls)){c=document.getElementById(n[i].getAttribute("for"));v={field:n[i].textContent};if(this.hasClass(c,s.min_cls,true)){message=e.getLang('invalid_data_min');v.min=this.getNum(c,s.min_cls)}else if(this.hasClass(c,s.number_cls)){message=e.getLang('invalid_data_number')}else if(this.hasClass(c,s.size_cls)){message=e.getLang('invalid_data_size')}else{message=e.getLang('invalid_data')}message=message.replace(/{\#([^}]+)\}/g,function(a,b){return v[b]||'{#'+b+'}'});d.push(message)}}return d},reset:function(e){var t=['label','input','select','textarea'];var i,j,n,s=this.settings;if(e==null)return;for(i=0;i<t.length;i++){n=this.tags(e.form?e.form:e,t[i]);for(j=0;j<n.length;j++){this.removeClass(n[j],s.invalid_cls);n[j].setAttribute('aria-invalid',false)}}},validateElms:function(f,e){var a,i,n,s=this.settings,b=true,c=Validator,v;a=this.tags(f,e);for(i=0;i<a.length;i++){n=a[i];this.removeClass(n,s.invalid_cls);if(this.hasClass(n,s.required_cls)&&c.isEmpty(n))b=this.mark(f,n);if(this.hasClass(n,s.number_cls)&&!c.isNumber(n))b=this.mark(f,n);if(this.hasClass(n,s.int_cls)&&!c.isNumber(n,true))b=this.mark(f,n);if(this.hasClass(n,s.url_cls)&&!c.isAbsUrl(n))b=this.mark(f,n);if(this.hasClass(n,s.email_cls)&&!c.isEmail(n))b=this.mark(f,n);if(this.hasClass(n,s.size_cls)&&!c.isSize(n))b=this.mark(f,n);if(this.hasClass(n,s.id_cls)&&!c.isId(n))b=this.mark(f,n);if(this.hasClass(n,s.min_cls,true)){v=this.getNum(n,s.min_cls);if(isNaN(v)||parseInt(n.value)<parseInt(v))b=this.mark(f,n)}if(this.hasClass(n,s.max_cls,true)){v=this.getNum(n,s.max_cls);if(isNaN(v)||parseInt(n.value)>parseInt(v))b=this.mark(f,n)}}return b},hasClass:function(n,c,d){return new RegExp('\\b'+c+(d?'[0-9]+':'')+'\\b','g').test(n.className)},getNum:function(n,c){c=n.className.match(new RegExp('\\b'+c+'([0-9]+)\\b','g'))[0];c=c.replace(/[^0-9]/g,'');return c},addClass:function(n,c,b){var o=this.removeClass(n,c);n.className=b?c+(o!=''?(' '+o):''):(o!=''?(o+' '):'')+c},removeClass:function(n,c){c=n.className.replace(new RegExp("(^|\\s+)"+c+"(\\s+|$)"),' ');return n.className=c!=' '?c:''},tags:function(f,s){return f.getElementsByTagName(s)},mark:function(f,n){var s=this.settings;this.addClass(n,s.invalid_cls);n.setAttribute('aria-invalid','true');this.markLabels(f,n,s.invalid_cls);return false},markLabels:function(f,n,a){var b,i;b=this.tags(f,"label");for(i=0;i<b.length;i++){if(b[i].getAttribute("for")==n.id||b[i].htmlFor==n.id)this.addClass(b[i],a)}return null}};
