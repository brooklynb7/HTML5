/**
 * editor_plugin_src.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http://tinymce.moxiecode.com/license
 * Contributing: http://tinymce.moxiecode.com/contributing
 */
(function(){var D=tinymce.DOM,E=tinymce.dom.Element,a=tinymce.dom.Event,b=tinymce.each,c=tinymce.is;tinymce.create('tinymce.plugins.InlinePopups',{init:function(e,u){e.onBeforeRenderUI.add(function(){e.windowManager=new tinymce.InlineWindowManager(e);D.loadCSS(u+'/skins/'+(e.settings.inlinepopups_skin||'clearlooks2')+"/window.css")})},getInfo:function(){return{longname:'InlinePopups',author:'Moxiecode Systems AB',authorurl:'http://tinymce.moxiecode.com',infourl:'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups',version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.create('tinymce.InlineWindowManager:tinymce.WindowManager',{InlineWindowManager:function(e){var t=this;t.parent(e);t.zIndex=300000;t.count=0;t.windows={}},open:function(f,p){var t=this,i,o='',d=t.editor,g=0,h=0,v,j,m,k,l,w,u,q;f=f||{};p=p||{};if(!f.inline)return t.parent(f,p);q=t._frontWindow();if(q&&D.get(q.id+'_ifr')){q.focussedElement=D.get(q.id+'_ifr').contentWindow.document.activeElement}if(!f.type)t.bookmark=d.selection.getBookmark(1);i=D.uniqueId();v=D.getViewPort();f.width=parseInt(f.width||320);f.height=parseInt(f.height||240)+(tinymce.isIE?8:0);f.min_width=parseInt(f.min_width||150);f.min_height=parseInt(f.min_height||100);f.max_width=parseInt(f.max_width||2000);f.max_height=parseInt(f.max_height||2000);f.left=f.left||Math.round(Math.max(v.x,v.x+(v.w/2.0)-(f.width/2.0)));f.top=f.top||Math.round(Math.max(v.y,v.y+(v.h/2.0)-(f.height/2.0)));f.movable=f.resizable=true;p.mce_width=f.width;p.mce_height=f.height;p.mce_inline=true;p.mce_window_id=i;p.mce_auto_focus=f.auto_focus;t.features=f;t.params=p;t.onOpen.dispatch(t,f,p);if(f.type){o+=' mceModal';if(f.type)o+=' mce'+f.type.substring(0,1).toUpperCase()+f.type.substring(1);f.resizable=false}if(f.statusbar)o+=' mceStatusbar';if(f.resizable)o+=' mceResizable';if(f.minimizable)o+=' mceMinimizable';if(f.maximizable)o+=' mceMaximizable';if(f.movable)o+=' mceMovable';t._addAll(D.doc.body,['div',{id:i,role:'dialog','aria-labelledby':f.type?i+'_content':i+'_title','class':(d.settings.inlinepopups_skin||'clearlooks2')+(tinymce.isIE&&window.getSelection?' ie9':''),style:'width:100px;height:100px'},['div',{id:i+'_wrapper','class':'mceWrapper'+o},['div',{id:i+'_top','class':'mceTop'},['div',{'class':'mceLeft'}],['div',{'class':'mceCenter'}],['div',{'class':'mceRight'}],['span',{id:i+'_title'},f.title||'']],['div',{id:i+'_middle','class':'mceMiddle'},['div',{id:i+'_left','class':'mceLeft',tabindex:'0'}],['span',{id:i+'_content'}],['div',{id:i+'_right','class':'mceRight',tabindex:'0'}]],['div',{id:i+'_bottom','class':'mceBottom'},['div',{'class':'mceLeft'}],['div',{'class':'mceCenter'}],['div',{'class':'mceRight'}],['span',{id:i+'_status'},'Content']],['a',{'class':'mceMove',tabindex:'-1',href:'javascript:;'}],['a',{'class':'mceMin',tabindex:'-1',href:'javascript:;',onmousedown:'return false;'}],['a',{'class':'mceMax',tabindex:'-1',href:'javascript:;',onmousedown:'return false;'}],['a',{'class':'mceMed',tabindex:'-1',href:'javascript:;',onmousedown:'return false;'}],['a',{'class':'mceClose',tabindex:'-1',href:'javascript:;',onmousedown:'return false;'}],['a',{id:i+'_resize_n','class':'mceResize mceResizeN',tabindex:'-1',href:'javascript:;'}],['a',{id:i+'_resize_s','class':'mceResize mceResizeS',tabindex:'-1',href:'javascript:;'}],['a',{id:i+'_resize_w','class':'mceResize mceResizeW',tabindex:'-1',href:'javascript:;'}],['a',{id:i+'_resize_e','class':'mceResize mceResizeE',tabindex:'-1',href:'javascript:;'}],['a',{id:i+'_resize_nw','class':'mceResize mceResizeNW',tabindex:'-1',href:'javascript:;'}],['a',{id:i+'_resize_ne','class':'mceResize mceResizeNE',tabindex:'-1',href:'javascript:;'}],['a',{id:i+'_resize_sw','class':'mceResize mceResizeSW',tabindex:'-1',href:'javascript:;'}],['a',{id:i+'_resize_se','class':'mceResize mceResizeSE',tabindex:'-1',href:'javascript:;'}]]]);D.setStyles(i,{top:-10000,left:-10000});if(tinymce.isGecko)D.setStyle(i,'overflow','auto');if(!f.type){g+=D.get(i+'_left').clientWidth;g+=D.get(i+'_right').clientWidth;h+=D.get(i+'_top').clientHeight;h+=D.get(i+'_bottom').clientHeight}D.setStyles(i,{top:f.top,left:f.left,width:f.width+g,height:f.height+h});u=f.url||f.file;if(u){if(tinymce.relaxedDomain)u+=(u.indexOf('?')==-1?'?':'&')+'mce_rdomain='+tinymce.relaxedDomain;u=tinymce._addVer(u)}if(!f.type){D.add(i+'_content','iframe',{id:i+'_ifr',src:'javascript:""',frameBorder:0,style:'border:0;width:10px;height:10px'});D.setStyles(i+'_ifr',{width:f.width,height:f.height});D.setAttrib(i+'_ifr','src',u)}else{D.add(i+'_wrapper','a',{id:i+'_ok','class':'mceButton mceOk',href:'javascript:;',onmousedown:'return false;'},'Ok');if(f.type=='confirm')D.add(i+'_wrapper','a',{'class':'mceButton mceCancel',href:'javascript:;',onmousedown:'return false;'},'Cancel');D.add(i+'_middle','div',{'class':'mceIcon'});D.setHTML(i+'_content',f.content.replace('\n','<br />'));a.add(i,'keyup',function(e){var V=27;if(e.keyCode===V){f.button_func(false);return a.cancel(e)}});a.add(i,'keydown',function(e){var n,V=9;if(e.keyCode===V){n=D.select('a.mceCancel',i+'_wrapper')[0];if(n&&n!==e.target){n.focus()}else{D.get(i+'_ok').focus()}return a.cancel(e)}})}m=a.add(i,'mousedown',function(e){var n=e.target,w,v;w=t.windows[i];t.focus(i);if(n.nodeName=='A'||n.nodeName=='a'){if(n.className=='mceClose'){t.close(null,i);return a.cancel(e)}else if(n.className=='mceMax'){w.oldPos=w.element.getXY();w.oldSize=w.element.getSize();v=D.getViewPort();v.w-=2;v.h-=2;w.element.moveTo(v.x,v.y);w.element.resizeTo(v.w,v.h);D.setStyles(i+'_ifr',{width:v.w-w.deltaWidth,height:v.h-w.deltaHeight});D.addClass(i+'_wrapper','mceMaximized')}else if(n.className=='mceMed'){w.element.moveTo(w.oldPos.x,w.oldPos.y);w.element.resizeTo(w.oldSize.w,w.oldSize.h);w.iframeElement.resizeTo(w.oldSize.w-w.deltaWidth,w.oldSize.h-w.deltaHeight);D.removeClass(i+'_wrapper','mceMaximized')}else if(n.className=='mceMove')return t._startDrag(i,e,n.className);else if(D.hasClass(n,'mceResize'))return t._startDrag(i,e,n.className.substring(13))}});k=a.add(i,'click',function(e){var n=e.target;t.focus(i);if(n.nodeName=='A'||n.nodeName=='a'){switch(n.className){case'mceClose':t.close(null,i);return a.cancel(e);case'mceButton mceOk':case'mceButton mceCancel':f.button_func(n.className=='mceButton mceOk');return a.cancel(e)}}});a.add([i+'_left',i+'_right'],'focus',function(e){var n=D.get(i+'_ifr');if(n){var r=n.contentWindow.document.body;var s=D.select(':input:enabled,*[tabindex=0]',r);if(e.target.id===(i+'_left')){s[s.length-1].focus()}else{s[0].focus()}}else{D.get(i+'_ok').focus()}});w=t.windows[i]={id:i,mousedown_func:m,click_func:k,element:new E(i,{blocker:1,container:d.getContainer()}),iframeElement:new E(i+'_ifr'),features:f,deltaWidth:g,deltaHeight:h};w.iframeElement.on('focus',function(){t.focus(i)});if(t.count==0&&t.editor.getParam('dialog_type','modal')=='modal'){D.add(D.doc.body,'div',{id:'mceModalBlocker','class':(t.editor.settings.inlinepopups_skin||'clearlooks2')+'_modalBlocker',style:{zIndex:t.zIndex-1}});D.show('mceModalBlocker');D.setAttrib(D.doc.body,'aria-hidden','true')}else D.setStyle('mceModalBlocker','z-index',t.zIndex-1);if(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||(tinymce.isIE&&!D.boxModel))D.setStyles('mceModalBlocker',{position:'absolute',left:v.x,top:v.y,width:v.w-2,height:v.h-2});D.setAttrib(i,'aria-hidden','false');t.focus(i);t._fixIELayout(i,1);if(D.get(i+'_ok'))D.get(i+'_ok').focus();t.count++;return w},focus:function(i){var t=this,w;if(w=t.windows[i]){w.zIndex=this.zIndex++;w.element.setStyle('zIndex',w.zIndex);w.element.update();i=i+'_wrapper';D.removeClass(t.lastId,'mceFocus');D.addClass(i,'mceFocus');t.lastId=i;if(w.focussedElement){w.focussedElement.focus()}else if(D.get(i+'_ok')){D.get(w.id+'_ok').focus()}else if(D.get(w.id+'_ifr')){D.get(w.id+'_ifr').focus()}}},_addAll:function(d,e){var i,n,t=this,f=tinymce.DOM;if(c(e,'string'))d.appendChild(f.doc.createTextNode(e));else if(e.length){d=d.appendChild(f.create(e[0],e[1]));for(i=2;i<e.length;i++)t._addAll(d,e[i])}},_startDrag:function(i,s,f){var t=this,m,g,d=D.doc,h,w=t.windows[i],j=w.element,k=j.getXY(),p,l,n,o,q,r,u,z,A,B,C,F,G;o={x:0,y:0};q=D.getViewPort();q.w-=2;q.h-=2;z=s.screenX;A=s.screenY;B=C=F=G=0;m=a.add(d,'mouseup',function(e){a.remove(d,'mouseup',m);a.remove(d,'mousemove',g);if(h)h.remove();j.moveBy(B,C);j.resizeBy(F,G);l=j.getSize();D.setStyles(i+'_ifr',{width:l.w-w.deltaWidth,height:l.h-w.deltaHeight});t._fixIELayout(i,1);return a.cancel(e)});if(f!='Move')H();function H(){if(h)return;t._fixIELayout(i,0);D.add(d.body,'div',{id:'mceEventBlocker','class':'mceEventBlocker '+(t.editor.settings.inlinepopups_skin||'clearlooks2'),style:{zIndex:t.zIndex+1}});if(tinymce.isIE6||(tinymce.isIE&&!D.boxModel))D.setStyles('mceEventBlocker',{position:'absolute',left:q.x,top:q.y,width:q.w-2,height:q.h-2});h=new E('mceEventBlocker');h.update();p=j.getXY();l=j.getSize();r=o.x+p.x-q.x;u=o.y+p.y-q.y;D.add(h.get(),'div',{id:'mcePlaceHolder','class':'mcePlaceHolder',style:{left:r,top:u,width:l.w,height:l.h}});n=new E('mcePlaceHolder')};g=a.add(d,'mousemove',function(e){var x,y,v;H();x=e.screenX-z;y=e.screenY-A;switch(f){case'ResizeW':B=x;F=0-x;break;case'ResizeE':F=x;break;case'ResizeN':case'ResizeNW':case'ResizeNE':if(f=="ResizeNW"){B=x;F=0-x}else if(f=="ResizeNE")F=x;C=y;G=0-y;break;case'ResizeS':case'ResizeSW':case'ResizeSE':if(f=="ResizeSW"){B=x;F=0-x}else if(f=="ResizeSE")F=x;G=y;break;case'mceMove':B=x;C=y;break}if(F<(v=w.features.min_width-l.w)){if(B!==0)B+=F-v;F=v}if(G<(v=w.features.min_height-l.h)){if(C!==0)C+=G-v;G=v}F=Math.min(F,w.features.max_width-l.w);G=Math.min(G,w.features.max_height-l.h);B=Math.max(B,q.x-(r+q.x));C=Math.max(C,q.y-(u+q.y));B=Math.min(B,(q.w+q.x)-(r+l.w+q.x));C=Math.min(C,(q.h+q.y)-(u+l.h+q.y));if(B+C!==0){if(r+B<0)B=0;if(u+C<0)C=0;n.moveTo(r+B,u+C)}if(F+G!==0)n.resizeTo(l.w+F,l.h+G);return a.cancel(e)});return a.cancel(s)},resizeBy:function(d,e,i){var w=this.windows[i];if(w){w.element.resizeBy(d,e);w.iframeElement.resizeBy(d,e)}},close:function(e,i){var t=this,w,d=D.doc,f,i;i=t._findId(i||e);if(!t.windows[i]){t.parent(e);return}t.count--;if(t.count==0){D.remove('mceModalBlocker');D.setAttrib(D.doc.body,'aria-hidden','false');t.editor.focus()}if(w=t.windows[i]){t.onClose.dispatch(t);a.remove(d,'mousedown',w.mousedownFunc);a.remove(d,'click',w.clickFunc);a.clear(i);a.clear(i+'_ifr');D.setAttrib(i+'_ifr','src','javascript:""');w.element.remove();delete t.windows[i];f=t._frontWindow();if(f)t.focus(f.id)}},_frontWindow:function(){var f,i=0;b(this.windows,function(w){if(w.zIndex>i){f=w;i=w.zIndex}});return f},setTitle:function(w,t){var e;w=this._findId(w);if(e=D.get(w+'_title'))e.innerHTML=D.encode(t)},alert:function(d,e,s){var t=this,w;w=t.open({title:t,type:'alert',button_func:function(s){if(e)e.call(s||t,s);t.close(null,w.id)},content:D.encode(t.editor.getLang(d,d)),inline:1,width:400,height:130})},confirm:function(d,e,s){var t=this,w;w=t.open({title:t,type:'confirm',button_func:function(s){if(e)e.call(s||t,s);t.close(null,w.id)},content:D.encode(t.editor.getLang(d,d)),inline:1,width:400,height:130})},_findId:function(w){var t=this;if(typeof(w)=='string')return w;b(t.windows,function(d){var i=D.get(d.id+'_ifr');if(i&&w==i.contentWindow){w=d.id;return false}});return w},_fixIELayout:function(d,s){var w,f;if(!tinymce.isIE6)return;b(['n','s','w','e','nw','ne','sw','se'],function(v){var e=D.get(d+'_resize_'+v);D.setStyles(e,{width:s?e.clientWidth:'',height:s?e.clientHeight:'',cursor:D.getStyle(e,'cursor',1)});D.setStyle(d+"_bottom",'bottom','-1px');e=0});if(w=this.windows[d]){w.element.hide();w.element.show();b(D.select('div,a',d),function(e,i){if(e.currentStyle.backgroundImage!='none'){f=new Image();f.src=e.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,'$1')}});D.get(d).style.filter=''}}});tinymce.PluginManager.add('inlinepopups',tinymce.plugins.InlinePopups)})();
