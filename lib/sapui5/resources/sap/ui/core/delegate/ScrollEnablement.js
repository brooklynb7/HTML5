/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 * 
 * (c) Copyright 2009-2013 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ui.core.delegate.ScrollEnablement");jQuery.sap.require("sap.ui.base.Object");(function($){sap.ui.base.Object.extend("sap.ui.core.delegate.ScrollEnablement",{constructor:function(c,s,C){sap.ui.base.Object.apply(this);this._oControl=c;this._oControl.addDelegate(this);this._sContentId=s;this._bHorizontal=!!C.horizontal;this._bVertical=!!C.vertical;this._scrollX=0;this._scrollY=0;this._scroller=null;a(this,C);if(this._init){this._init.apply(this,arguments)}},setHorizontal:function(h){this._bHorizontal=!!h;if(this._scroller&&this._zynga){this._scroller.options.scrollingX=this._bHorizontal}},setVertical:function(v){this._bVertical=!!v;if(this._scroller&&this._zynga){this._scroller.options.scrollingY=this._bVertical}},getHorizontal:function(){return this._bHorizontal},getVertical:function(){return this._bVertical},setPullDown:function(c){this._oPullDown=c;return this},scrollTo:function(x,y,t){this._scrollX=x;this._scrollY=y;if(this._scroller){if(this._zynga){if(!isNaN(t)){this._scroller.options.animationDuration=t}this._scroller.scrollTo(x,y,!!t)}else{this._scroller.scrollTo(-x,-y,t,false)}}return this},destroy:function(){if(this._exit){this._exit()}if(this._oControl){this._oControl.removeDelegate(this);this._oControl=undefined}this._isDestroyed=true},refresh:function(){if(this._refresh){this._refresh()}}});var i={_refresh:function(){if(this._scroller&&this._sContentId&&$.sap.domById(this._sContentId)){this._scroller.refresh()}},_cleanup:function(){if(this._sScrollerResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sScrollerResizeListenerId);this._sScrollerResizeListenerId=null}if(this._sContentResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sContentResizeListenerId);this._sContentResizeListenerId=null}if(this._scroller){this._scroller.stop();this._scrollX=-this._scroller.x;this._scrollY=-this._scroller.y;this._scroller.destroy();this._scroller=null}},onBeforeRendering:function(){this._cleanup()},onAfterRendering:function(){var t=this,b=false;if($.os.ios||this._oPullDown){b=true}var c=$.sap.byId(this._sContentId);this._sScrollerId=c.parent().attr("id");var A=$.os.android&&!$.browser.chrome&&parseFloat($.os.version)==4&&c.find("input").length;this._iTopOffset=this._oPullDown&&this._oPullDown.getDomRef&&this._oPullDown.getDomRef().offsetHeight||0;this._scroller=new window.iScroll(this._sScrollerId,{useTransition:true,useTransform:!A,hideScrollbar:true,fadeScrollbar:true,bounce:b,momentum:true,handleClick:false,hScroll:this._bHorizontal,vScroll:this._bVertical,topOffset:this._iTopOffset,onBeforeScrollStart:function(e){if(document.activeElement&&document.activeElement.tagName=="INPUT"&&!(e.target.tagName=="INPUT"||$(e.target).hasClass("sapMInputPlaceholder")||$(e.target).hasClass("sapMSFR"))){$.sap.log.debug("Close active input by scroll start");document.activeElement.blur()}},onScrollEnd:function(){if(t._scroll){t._scrollX=-t._scroll.x;t._scrollY=-t._scroll.y}if(t._oPullDown){t._oPullDown.doScrollEnd()}},onRefresh:function(){if(t._oPullDown){t._oPullDown.doRefresh()}},onScrollMove:function(){if(t._oPullDown){t._oPullDown.doScrollMove()}}});for(var p=this._oControl;p=p.oParent;){var s=p.getScrollDelegate?p.getScrollDelegate():null;if(s&&(s.getVertical()&&this.getVertical()||s.getHorizontal()&&this.getHorizontal())){this._scroller._sapui_isNested=true;break}}this._scroller._move=function(e){if(e._sapui_handledByControl){return}if(this._sapui_isNested){e._sapui_handledByControl=!(this.dirY<0&&this.y>=0)&&!(this.dirY>0&&this.y<=this.maxScrollY)&&!(this.dirX<0&&this.x>=0)&&!(this.dirX>0&&this.x<=this.maxScrollX)}window.iScroll.prototype._move.call(this,e)};if(this._scrollX!=-this._scroller.x||this._scrollY!=-this._scroller.y){this._scroller.scrollTo(-this._scrollX,-this._scrollY,0)}this._sScrollerResizeListenerId=sap.ui.core.ResizeHandler.register($.sap.domById(this._sScrollerId),$.proxy(function(){if((!this._sContentId||!$.sap.domById(this._sContentId))&&this._sScrollerResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sScrollerResizeListenerId);this._sScrollerResizeListenerId=null}else{this._refresh()}},this));this._sContentResizeListenerId=sap.ui.core.ResizeHandler.register($.sap.domById(this._sContentId),$.proxy(function(){if((!this._sContentId||!$.sap.domById(this._sContentId))&&this._sContentResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sContentResizeListenerId);this._sContentResizeListenerId=null}else{this._refresh()}},this))},ontouchmove:function(e){if(this._preventTouchMoveDefault){e.preventDefault()}},};var z={_refresh:function(){if(this._scroller&&this._sContentId&&$.sap.domById(this._sContentId)){var c=$.sap.byId(this._sContentId);var C=c.parent();this._scroller.setDimensions(C.width(),C.height(),c.width(),c.height())}},_cleanup:function(){if(this._sScrollerResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sScrollerResizeListenerId);this._sScrollerResizeListenerId=null}if(this._sContentResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sContentResizeListenerId);this._sContentResizeListenerId=null}if(this._scroller){var v=this._scroller.getValues();this._scrollX=v.left;this._scrollY=v.top}},onBeforeRendering:function(){this._cleanup()},onAfterRendering:function(){this._refresh();this._scroller.scrollTo(this._scrollX,this._scrollY,false);this._sContentResizeListenerId=sap.ui.core.ResizeHandler.register($.sap.domById(this._sContentId),$.proxy(function(){if((!this._sContentId||!$.sap.domById(this._sContentId))&&this._sContentResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sContentResizeListenerId);this._sContentResizeListenerId=null}else{this._refresh()}},this))},ontouchstart:function(e){if(e.target.tagName.match(/input|textarea|select/i)){return}this._scroller.doTouchStart(e.touches,e.timeStamp)},ontouchend:function(e){this._scroller.doTouchEnd(e.timeStamp)},ontouchmove:function(e){this._scroller.doTouchMove(e.touches,e.timeStamp);if(this._preventTouchMoveDefault){e.preventDefault()}else{e.stopPropagation()}}};function a(s,c){var d;if(!$.support.touch&&!c.nonTouchScrolling){d={}}else{$.sap.require("jquery.sap.mobile");d={_init:function(C,S,c){function b(e,h,v){var o=new window.Scroller(function(f,t,g){var j=$.sap.byId(e).parent();j.scrollLeft(f);j.scrollTop(t)},{scrollingX:h,scrollingY:v,bouncing:false});return o}var l=c.zynga?"z":"i";this._preventTouchMoveDefault=!!c.preventDefault;this._scroller=null;switch(l){case"z":$.sap.require("sap.ui.thirdparty.zyngascroll");$.extend(this,z);this._zynga=true;this._scroller=b(this._sContentId,this._bHorizontal,this._bVertical);break;default:$.sap.require("sap.ui.thirdparty.iscroll");$.extend(this,i);break}},_exit:function(){if(this._cleanup){this._cleanup()}this._scroller=null}}}$.extend(s,d)}}(jQuery));
