tinyMCEPopup.requireLangPack();var LinkDialog={preInit:function(){var u;if(u=tinyMCEPopup.getParam("external_link_list_url"))document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(u)+'"></script>')},init:function(){var f=document.forms[0],a=tinyMCEPopup.editor;document.getElementById('hrefbrowsercontainer').innerHTML=getBrowserHTML('hrefbrowser','href','file','theme_advanced_link');if(isVisible('hrefbrowser'))document.getElementById('href').style.width='180px';this.fillClassList('class_list');this.fillFileList('link_list','tinyMCELinkList');this.fillTargetList('target_list');if(e=a.dom.getParent(a.selection.getNode(),'A')){f.href.value=a.dom.getAttrib(e,'href');f.linktitle.value=a.dom.getAttrib(e,'title');f.insert.value=a.getLang('update');selectByValue(f,'link_list',f.href.value);selectByValue(f,'target_list',a.dom.getAttrib(e,'target'));selectByValue(f,'class_list',a.dom.getAttrib(e,'class'))}},update:function(){var f=document.forms[0],a=tinyMCEPopup.editor,e,b,h=f.href.value.replace(/ /g,'%20');tinyMCEPopup.restoreSelection();e=a.dom.getParent(a.selection.getNode(),'A');if(!f.href.value){if(e){b=a.selection.getBookmark();a.dom.remove(e,1);a.selection.moveToBookmark(b);tinyMCEPopup.execCommand("mceEndUndoLevel");tinyMCEPopup.close();return}}if(e==null){a.getDoc().execCommand("unlink",false,null);tinyMCEPopup.execCommand("mceInsertLink",false,"#mce_temp_url#",{skip_undo:1});tinymce.each(a.dom.select("a"),function(n){if(a.dom.getAttrib(n,'href')=='#mce_temp_url#'){e=n;a.dom.setAttribs(e,{href:h,title:f.linktitle.value,target:f.target_list?getSelectValue(f,"target_list"):null,'class':f.class_list?getSelectValue(f,"class_list"):null})}})}else{a.dom.setAttribs(e,{href:h,title:f.linktitle.value});if(f.target_list){a.dom.setAttrib(e,'target',getSelectValue(f,"target_list"))}if(f.class_list){a.dom.setAttrib(e,'class',getSelectValue(f,"class_list"))}}if(e.childNodes.length!=1||e.firstChild.nodeName!='IMG'){a.focus();a.selection.select(e);a.selection.collapse(0);tinyMCEPopup.storeSelection()}tinyMCEPopup.execCommand("mceEndUndoLevel");tinyMCEPopup.close()},checkPrefix:function(n){if(n.value&&Validator.isEmail(n)&&!/^\s*mailto:/i.test(n.value)&&confirm(tinyMCEPopup.getLang('advanced_dlg.link_is_email')))n.value='mailto:'+n.value;if(/^\s*www\./i.test(n.value)&&confirm(tinyMCEPopup.getLang('advanced_dlg.link_is_external')))n.value='http://'+n.value},fillFileList:function(i,l){var d=tinyMCEPopup.dom,a=d.get(i),v,c;l=window[l];if(l&&l.length>0){a.options[a.options.length]=new Option('','');tinymce.each(l,function(o){a.options[a.options.length]=new Option(o[0],o[1])})}else d.remove(d.getParent(i,'tr'))},fillClassList:function(i){var d=tinyMCEPopup.dom,l=d.get(i),v,c;if(v=tinyMCEPopup.getParam('theme_advanced_styles')){c=[];tinymce.each(v.split(';'),function(v){var p=v.split('=');c.push({'title':p[0],'class':p[1]})})}else c=tinyMCEPopup.editor.dom.getClasses();if(c.length>0){l.options[l.options.length]=new Option(tinyMCEPopup.getLang('not_set'),'');tinymce.each(c,function(o){l.options[l.options.length]=new Option(o.title||o['class'],o['class'])})}else d.remove(d.getParent(i,'tr'))},fillTargetList:function(i){var d=tinyMCEPopup.dom,l=d.get(i),v;l.options[l.options.length]=new Option(tinyMCEPopup.getLang('not_set'),'');l.options[l.options.length]=new Option(tinyMCEPopup.getLang('advanced_dlg.link_target_same'),'_self');l.options[l.options.length]=new Option(tinyMCEPopup.getLang('advanced_dlg.link_target_blank'),'_blank');if(v=tinyMCEPopup.getParam('theme_advanced_link_targets')){tinymce.each(v.split(','),function(v){v=v.split('=');l.options[l.options.length]=new Option(v[0],v[1])})}}};LinkDialog.preInit();tinyMCEPopup.onInit.add(LinkDialog.init,LinkDialog);
