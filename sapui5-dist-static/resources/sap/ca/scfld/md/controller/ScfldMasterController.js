jQuery.sap.require("sap.ui.core.mvc.Controller");jQuery.sap.require("sap.ca.scfld.md.app.CommonHeaderFooterHelper");sap.ui.core.mvc.Controller.extend("sap.ca.scfld.md.controller.ScfldMasterController",{_onMasterListChanged:function(e){if(e.getParameter("reason")==="change"){this._oApplicationImplementation.onMasterChanged(this);this.selectItemMatchingTheLastNavigation()}},_handleItemPress:function(e){this.setListItem(e.getSource())},_handleSelect:function(e){this.setListItem(e.getParameter("listItem"));if(!sap.ui.Device.system.phone){this._oApplicationImplementation.oSplitContainer.hideMaster()}},_onMasterListLoaded:function(e){if(e.getParameter("reason")==="change"){this.onDataLoaded();this._oApplicationImplementation.onMasterRefreshed(this);e.oSource.detachChange(this._onMasterListLoaded,this);this._bListLoaded=true;this.fireEvent("_onMasterListLoaded")}},constructor:function(){sap.ui.core.mvc.Controller.apply(this,arguments);var t=this;this._bListLoaded=false;var r=0;var c=null;var m=jQuery.proxy(function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this._oApplicationImplementation=sap.ca.scfld.md.app.Application.getImpl();this.oApplicationFacade=this._oApplicationImplementation.oConfiguration.oApplicationFacade;c=this._oApplicationImplementation.getConnectionManager();r=c.iRequestCount;this._oApplicationImplementation.setModels(this);this._iRequestCount=0;var M=c.getModel(this.sModelName);M.attachRequestSent(null,function(){this._iRequestCount++},this);M.attachRequestCompleted(null,function(){this._iRequestCount--;if(this._iRequestCount<0){this._iRequestCount=0}if(this._iRequestCount===0){this.fireEvent("_allListModelUpdatesCompleted")}},this);this.oRouter.attachRoutePatternMatched(function(e){this._sDetailContextPath=undefined;if(this.isDetailRoute(e)){this._onDetailMatched(e)}if(this.isMasterRoute(e)){this._onMasterMatched(e)}},this)},this);var a=jQuery.proxy(this.onInit,this);this.onInit=jQuery.proxy(function(){m();a();var l=this.getList();if(l){var b=l.getBinding("items");this._oApplicationImplementation.setMasterListBinding(this,b)}if(r==c.iRequestCount){this._oApplicationImplementation.oMHFHelper.defineMasterHeaderFooter(this)}},this)},onInit:function(){},getPage:function(){return sap.ca.scfld.md.app.CommonHeaderFooterHelper.getPageFromController(this)},getList:function(){return this.byId("list")},setListItem:function(i){var l=this.getList();if(l){l.removeSelections(true)}i.setSelected(true);this._navToListItem(i)},isDetailRoute:function(e){var n=e.getParameter("name");return n===this.getDetailRouteName()},getDetailRouteName:function(){return"detail"},isMasterRoute:function(e){var n=e.getParameter("name");return n===this.getMasterRouteName()},getMasterRouteName:function(){return"master"},_onMasterMatched:function(e){if(sap.ui.Device.system.phone){return}if(!this._bListLoaded){this.attachEventOnce("_onMasterListLoaded",function(){this.selectFirstItem()},this)}else{this.selectFirstItem()}},_onDetailMatched:function(e){var c=this._sDetailContextPath=this.getBindingContextPathFor(e.getParameter("arguments"));if(this._iRequestCount>0){this.attachEventOnce("_allListModelUpdatesCompleted",function(){this._handleDetailMatched(c)},this);return}if(!this._bListLoaded){this.attachEventOnce("_onMasterListLoaded",function(){this._handleDetailMatched(c)},this)}else{this._handleDetailMatched(c)}},_handleDetailMatched:function(c){if(c===undefined){return}var i=this.findItemByContextPath(c);if(!i){if(!sap.ui.Device.system.phone&&this.isBackendSearch()){this.applyFilterFromContext(c);return}this.noItemFoundForContext(c);return}var l=this.getList();if(!sap.ui.Device.system.phone&&i){if(l){l.removeSelections(true)}i.setSelected(true)}},selectItemMatchingTheLastNavigation:function(){var l=this.getList();if(this._sDetailContextPath===undefined){return}var i=l.getSelectedItem();var c=i&&i.getBindingContext(this.sModelName);if(c&&c.getPath===this._sDetailContextPath){return}i=this.findItemByContextPath(this._sDetailContextPath);if(i){if(l){l.removeSelections(true)}i.setSelected(true)}},noItemFoundForContext:function(c){this.showEmptyView()},findItemByContextPath:function(c){var b;var l=this.getList();var i=l.getItems();var r=jQuery.grep(i,function(I){b=I.getBindingContext(this.sModelName);if(I instanceof sap.m.GroupHeaderListItem){return false}if(b&&(b.getPath()!==c)){return false}return true});return r[0]||null},getBindingContextPathFor:function(a){if(a.contextPath===undefined){jQuery.sap.log.warning("The context path was undefined. If you are using a route without it please overwrite the function getBindingContextPathFor in your master controller.");return undefined}return"/"+a.contextPath},selectFirstItem:function(){var l=this.getList();var i=l.getItems();var L;if(i.length<1){return}L=this._oApplicationImplementation.getFirstListItem(this);if(L){this.setListItem(L)}},_navToListItem:function(l){this.oRouter.navTo(this.getDetailRouteName(),this.getDetailNavigationParameters(l),!jQuery.device.is.phone)},getDetailNavigationParameters:function(l){return{contextPath:l.getBindingContext(this.sModelName).getPath().substr(1)}},getHeaderFooterOptions:function(){return null},setBtnEnabled:function(i,e){if(this._oControlStore.oButtonListHelper){this._oControlStore.oButtonListHelper.setBtnEnabled(i,e)}},setBtnText:function(i,t){if(this._oControlStore.oButtonListHelper){this._oControlStore.oButtonListHelper.setBtnText(i,t)}},refreshHeaderFooterForEditToggle:function(){this._oApplicationImplementation.oMHFHelper.defineMasterHeaderFooterInner(this)},onDataLoaded:function(){},showEmptyView:function(v,l){var L=this.getList();L.removeSelections();var V=this.oRouter.getView("sap.ca.scfld.md.view."+this.getNoDataViewName(),sap.ui.core.mvc.ViewType.XML);var s=this.getSplitContainer();s.addPage(V);if(v===undefined){v="DETAIL_TITLE"}if(l===undefined){l="NO_ITEMS_AVAILABLE"}s.to(V.getId(),"show",{viewTitle:v,languageKey:l});return this},getSplitContainer:function(){return this.getView().getParent().getParent()},getNoDataViewName:function(){return"empty"},navToEmptyView:function(){this.showEmptyView()},applySearchPattern:function(f){f=f.toLowerCase();var l=this.getList().getItems();var v;var c=0;for(var i=0;i<l.length;i++){v=this.applySearchPatternToListItem(l[i],f);l[i].setVisible(v);if(v){c++}}return c},applyBackendSearchPattern:function(f,b){},applyFilterFromContext:function(c){this.showEmptyView()},applySearchPatternToListItem:function(i,f){if(f==""){return true}var I=i.getBindingContext(this.sModelName).getProperty();for(var k in I){var v=I[k];if(typeof v=="string"){if(v.toLowerCase().indexOf(f)!=-1){return true}}}if((i.getIntro()&&i.getIntro().toLowerCase().indexOf(f)!=-1)||(i.getTitle()&&i.getTitle().toLowerCase().indexOf(f)!=-1)||(i.getNumber()&&i.getNumber().toLowerCase().indexOf(f)!=-1)||(i.getNumberUnit()&&i.getNumberUnit().toLowerCase().indexOf(f)!=-1)||(i.getFirstStatus()&&i.getFirstStatus().getText().toLowerCase().indexOf(f)!=-1)||(i.getSecondStatus()&&i.getSecondStatus().getText().toLowerCase().indexOf(f)!=-1)){return true}var a=i.getAttributes();for(var j=0;j<a.length;j++){if(a[j].getText().toLowerCase().indexOf(f)!=-1){return true}}return false},_applyClientSideSearch:function(){var f=this._oControlStore.oMasterSearchField.getValue();var c=this.applySearchPattern(f);this._oApplicationImplementation.oMHFHelper.setMasterTitle(this,c)},isLiveSearch:function(){return!this.isBackendSearch()},isBackendSearch:function(){return false},registerMasterListBind:function(){var l=this.getList();var b=l.getBinding("items");var c=this._oApplicationImplementation.getConnectionManager();var r=c.iRequestCount;this._oApplicationImplementation.setMasterListBinding(this,b);if(r==c.iRequestCount){this._oApplicationImplementation.oMHFHelper.defineMasterHeaderFooter(this)}}});
