/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright
 * 		2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.ca.ui.GrowingTileContainer");jQuery.sap.require("sap.ca.ui.library");jQuery.sap.require("sap.m.ScrollContainer");sap.m.ScrollContainer.extend("sap.ca.ui.GrowingTileContainer",{metadata:{library:"sap.ca.ui",properties:{"growing":{type:"boolean",group:"Misc",defaultValue:false},"growingThreshold":{type:"int",group:"Misc",defaultValue:20},"growingScrollToLoad":{type:"boolean",group:"Misc",defaultValue:false}}}});jQuery.sap.require("sap.ui.layout.Grid");
sap.ca.ui.GrowingTileContainer.prototype.init=function(){sap.m.ScrollContainer.prototype.init.call(this);this._iItemCount=0};
sap.ca.ui.GrowingTileContainer.prototype.destroy=function(){if(this._oBusyIndicator){this._oBusyIndicator.destroy();delete this._oBusyIndicator}if(this._oGridLayout){this._oGridLayout.destroy();delete this._oGridLayout}if(this._oScrollDelegate){this._unbindGrowingDelegate();this._oScrollDelegate=null}this._unbindDataEvents()};
sap.ca.ui.GrowingTileContainer.prototype.onBeforRendering=function(){this._unbindDataEvents()};
sap.ca.ui.GrowingTileContainer.prototype.onAfterRendering=function(){this._bCountChecked=false;this._bindGrowingDelegate();this._bindDataEvents()};
sap.ca.ui.GrowingTileContainer.prototype._bindDataEvents=function(){var b=this.getBinding("content");if(b){b.attachDataRequested(this._onDataRequested,this);b.attachDataReceived(this._onDataReceived,this)}};
sap.ca.ui.GrowingTileContainer.prototype._unbindDataEvents=function(){var b=this.getBinding("content");if(b){b.detachDataRequested(this._onDataRequested,this);b.detachDataReceived(this._onDataReceived,this)}};
sap.ca.ui.GrowingTileContainer.prototype._onDataRequested=function(){this._getBusyIndicator().setVisible(true)};
sap.ca.ui.GrowingTileContainer.prototype._onDataReceived=function(){this._getBusyIndicator().setVisible(false)};
sap.ca.ui.GrowingTileContainer.prototype._getBusyIndicator=function(){if(!this._oBusyIndicator){this._oBusyIndicator=new sap.m.BusyIndicator({size:"2.0rem"})}if(!this._oBusyIndicator.getDomRef()){this._renderAndFlushLayoutItem(this._oBusyIndicator)}return this._oBusyIndicator};
sap.ca.ui.GrowingTileContainer.prototype.updateContent=function(c){var b=this.getBindingInfo("content");if(this.getGrowing()&&b){if(this._iItemCount==0||c==sap.ui.model.ChangeReason.Filter){this._iItemCount=this.getGrowingThreshold()}var f=b.factory,B=b.binding,o=sap.ui.model&&sap.ui.model.odata&&sap.ui.model.odata.ODataListBinding,O=o&&B instanceof o,C=B?B.getContexts(0,this._iItemCount):[];if(C.length>0){var L=this.getId()+"-scroll";if(jQuery.sap.domById(L)!=null){if(C.diff){var I,a;for(var i=0,l=C.diff.length;i<l;i++){I=this.getContent();if(C.diff[i].type==="delete"){this.deleteListItem(I[C.diff[i].index])}if(C.diff[i].type==="insert"){a=f("",C[C.diff[i].index]);a.setBindingContext(C[C.diff[i].index],b.model);this.insertListItem(a,C.diff[i].index)}}I=this.getContent();for(var i=0,l=C.length;i<l;i++){if(I[i]){I[i].setBindingContext(C[i],b.model)}}}else{this._iRenderedDataItems=0;this.destroyAggregation("content");for(var i=0,l=C.length;i<l;i++){var a=f("",C[i]);a.setBindingContext(C[i],b.model);this.addListItem(a,false)}}}else{for(var i=0,l=C.length;i<l;i++){var a=f("",C[i]);a.setBindingContext(C[i],b.model);this.addListItem(a,true)}}}else{this.destroyAggregation("content");this._getGridLayout().destroyAggregation("content");this._iRenderedDataItems=0}}else{this.updateAggregation("content");this._getGridLayout().updateAggregation("content")}};
sap.ca.ui.GrowingTileContainer.prototype.addListItem=function(i,s){if(!this._bCountChecked){this._bCountChecked=true}this._iRenderedDataItems++;var b=this.getBinding("content");this.addAggregation("content",i,s);if(s){this._renderAndFlushLayoutItem(i)}return this};
sap.ca.ui.GrowingTileContainer.prototype.insertListItem=function(i,I){if(!this._bCountChecked){this._bCountChecked=true}this.insertAggregation("content",i,I,true);this._iRenderedDataItems++;this._renderAndFlushLayoutItem(i,I);return this};
sap.ca.ui.GrowingTileContainer.prototype.deleteListItem=function(i){if(i){this._iRenderedDataItems--;this.removeAggregation("content",i,true);jQuery.sap.byId(this._getItemWrapperId(i)).remove();i.destroy();return this}},sap.ca.ui.GrowingTileContainer.prototype._getItemWrapperId=function(i){if(i){return i.getId()+"_wrapper"}return""},sap.ca.ui.GrowingTileContainer.prototype._getDomIndex=function(i){return(typeof i==="number")?i:true};
sap.ca.ui.GrowingTileContainer.prototype._getItemsContainer=function(){if(!this._oGridLayout){var g=this._getGridLayout();return g.getDomRef()}return this._oGridLayout.getDomRef()};
sap.ca.ui.GrowingTileContainer.prototype._getGridLayout=function(){if(!this._oGridLayout){this._oGridLayout=new sap.ui.layout.Grid({id:this.getId()+"-grid",width:'auto',inContainer:true,vSpacing:1,hSpacing:1,position:sap.ui.layout.GridPosition.Center,defaultSpan:"L4 M6 S12",defaultIndent:"L0 M0 S0",})}return this._oGridLayout};
sap.ca.ui.GrowingTileContainer.prototype.onLoadMorePressed=function(){jQuery.sap.delayedCall(0,this,function(){this._iItemCount+=this.getGrowingThreshold();this.updateContent()})},sap.ca.ui.GrowingTileContainer.prototype.setGrowing=function(g){if(this.getGrowing()!=g){this.setProperty("growing",g);if(g){this._iItemCount+=this.getGrowingThreshold();this.bUseExtendedChangeDetection=true}else if(this._oGrowingDelegate){this._oGrowingDelegate.destroy();this._oGrowingDelegate=null}}return this};sap.ca.ui.GrowingTileContainer.prototype._getListItemCount=function(){var b=this.getBinding("content");if(b){return b.getLength()||0}return this.getContent().length},sap.ca.ui.GrowingTileContainer.prototype._triggerLoadingByScroll=function(e){if(this._iItemCount<this._getListItemCount()){jQuery.sap.clearDelayedCall(this._delayCallId);this._delayCallId=jQuery.sap.delayedCall(1000,this,function(){jQuery.sap.log.info("loading elements triggered on scroll");this._iItemCount+=this.getGrowingThreshold();this.updateContent()})}};
sap.ca.ui.GrowingTileContainer.prototype._unbindGrowingDelegate=function(){if(this._oScrollDelegate){jQuery.sap.log.debug("unbinding scroll delegate");delete this._fnProxytriggerLoadingByScroll;this._oScrollDelegate.setGrowingList(null)}};
sap.ca.ui.GrowingTileContainer.prototype._bindGrowingDelegate=function(){var s=sap.m.getScrollDelegate(this);if(s){jQuery.sap.log.debug("binding scroll delegate");this._oScrollDelegate=s;this._fnProxytriggerLoadingByScroll=jQuery.proxy(this._triggerLoadingByScroll,this);s.setGrowingList(this,this._fnProxytriggerLoadingByScroll)}};
sap.ca.ui.GrowingTileContainer.prototype._renderAndFlushLayoutItem=function(i,I){var a=/^([L](?:[0-9]|1[0-1]))? ?([M](?:[0-9]|1[0-1]))? ?([S](?:[0-9]|1[0-1]))?$/i;var S=/^([L](?:[1-9]|1[0-2]))? ?([M](?:[1-9]|1[0-2]))? ?([S](?:[1-9]|1[0-2]))?$/i;var g=this._getGridLayout();var d=g.getDefaultSpan();var b=g.getDefaultIndent();var D=a.exec(b);var c=["","L3","M6","S12"];var e=S.exec(d);var o=this._getItemsContainer();if(o){var r=sap.ui.getCore().createRenderManager();r.write("<div id="+this._getItemWrapperId(i));var L=g._getLayoutDataForControl(i);if(L){if(L.getLinebreak()===true){r.addClass("sapUiRespGridBreak")}else{if(L.getLinebreakL()===true){r.addClass("sapUiRespGridBreakL")}if(L.getLinebreakM()===true){r.addClass("sapUiRespGridBreakM")}if(L.getLinebreakS()===true){r.addClass("sapUiRespGridBreakS")}}var f;var h=L.getSpan();if(!h||!h.length==0){f=e}else{f=S.exec(h)}if(f){for(var j=1;j<f.length;j++){var k=f[j];if(!k){k=e[j];if(!k){k=c[j]}}var n=L.getSpanLarge();var p=L.getSpanMedium();var q=L.getSpanSmall();k=k.toUpperCase();if((k.substr(0,1)==="L")&&(n>0)&&(n<13)){r.addClass("sapUiRespGridSpanL"+n)}else if((k.substr(0,1)==="M")&&(p>0)&&(p<13)){r.addClass("sapUiRespGridSpanM"+p)}else if((k.substr(0,1)==="S")&&(q>0)&&(q<13)){r.addClass("sapUiRespGridSpanS"+q)}else{r.addClass("sapUiRespGridSpan"+k)}}}var t;var u=L.getIndent();if(!u||u.length==0){t=D}else{t=a.exec(u)}if(!t){t=D;if(!t){t=undefined}}if(t){for(var j=1;j<t.length;j++){var v=t[j];if(!v){if(D&&D[j]){v=D[j]}}if(v){v=v.toUpperCase();if(!(/^(L0)? ?(M0)? ?(S0)?$/.exec(v))){var w=L.getIndentLarge();var x=L.getIndentMedium();var y=L.getIndentSmall();if((v.substr(0,1)==="L")&&(w>0)&&(w<12)){r.addClass("sapUiRespGridIndentL"+w)}else if((v.substr(0,1)==="M")&&(x>0)&&(x<12)){r.addClass("sapUiRespGridIndentM"+x)}else if((v.substr(0,1)==="S")&&(y>0)&&(y<12)){r.addClass("sapUiRespGridIndentS"+y)}else{r.addClass("sapUiRespGridIndent"+v)}}}}}var l=L.getVisibleOnLarge(),m=L.getVisibleOnMedium(),s=L.getVisibleOnSmall();if(!l&&m&&s){r.addClass("sapUiRespGridHiddenL")}else if(!l&&!m&&s){r.addClass("sapUiRespGridVisibleS")}else if(l&&!m&&!s){r.addClass("sapUiRespGridVisibleL")}else if(!l&&m&&!s){r.addClass("sapUiRespGridVisibleM")}else if(l&&!m&&s){r.addClass("sapUiRespGridHiddenM")}else if(l&&m&&!s){r.addClass("sapUiRespGridHiddenS")}var M=L.getMoveBackwards();if(M&&M.length>0){var z=a.exec(M);if(z){for(var j=1;j<z.length;j++){var A=z[j];if(A){r.addClass("sapUiRespGridBwd"+A.toUpperCase())}}}}var B=L.getMoveForward();if(B&&B.length>0){var C=a.exec(B);if(C){for(var j=1;j<C.length;j++){var E=C[j];if(E){r.addClass("sapUiRespGridFwd"+E.toUpperCase())}}}}if(L._sStylesInternal){r.addClass(L._sStylesInternal)}}if(!L){var k="";if(e){for(var j=1;j<e.length;j++){k=e[j];if(!k){k=c[j]}r.addClass("sapUiRespGridSpan"+k.toUpperCase())}}else{for(var j=1;j<c.length;j++){k=c[j];r.addClass("sapUiRespGridSpan"+k.toUpperCase())}}}r.writeClasses();r.write(">");r.renderControl(i);r.write("</div>");r.flush(o,false,this._getDomIndex(I));r.destroy()}};
sap.ca.ui.GrowingTileContainer.prototype.getHorizontal=function(){return false}
