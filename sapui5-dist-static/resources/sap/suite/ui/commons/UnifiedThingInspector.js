/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2012 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.suite.ui.commons.UnifiedThingInspector");jQuery.sap.require("sap.suite.ui.commons.library");jQuery.sap.require("sap.ui.core.Control");sap.ui.core.Control.extend("sap.suite.ui.commons.UnifiedThingInspector",{metadata:{publicMethods:["getSelectedFacet","navigateToDetailWithContent","navigateToDetail","navigateToPage"],library:"sap.suite.ui.commons",properties:{"height":{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:'100%'},"title":{type:"string",group:"Misc",defaultValue:null},"name":{type:"string",group:"Misc",defaultValue:null},"description":{type:"string",group:"Misc",defaultValue:null},"icon":{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},"transactionsVisible":{type:"boolean",group:"Misc",defaultValue:false},"actionsVisible":{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{"facets":{type:"sap.suite.ui.commons.FacetOverview",multiple:true,singularName:"facet"},"facetContent":{type:"sap.ui.core.Control",multiple:true,singularName:"facetContent"},"navContainer":{type:"sap.m.NavContainer",multiple:false,visibility:"hidden"},"kpis":{type:"sap.suite.ui.commons.KpiTile",multiple:true,singularName:"kpi"},"transactions":{type:"sap.ui.core.Control",multiple:true,singularName:"transaction"},"actions":{type:"sap.m.Button",multiple:true,singularName:"action"}},events:{"backAction":{},"transactionsButtonPress":{allowPreventDefault:true},"actionsButtonPress":{allowPreventDefault:true},"configurationButtonPress":{}}}});sap.suite.ui.commons.UnifiedThingInspector.M_EVENTS={'backAction':'backAction','transactionsButtonPress':'transactionsButtonPress','actionsButtonPress':'actionsButtonPress','configurationButtonPress':'configurationButtonPress'};jQuery.sap.require("sap.m.NavContainer");jQuery.sap.require("sap.ui.layout.Grid");jQuery.sap.require("sap.ui.core.IconPool");
sap.suite.ui.commons.UnifiedThingInspector.prototype.init=function(){var t=this;this._rb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");this._bDetailPageIsTransitioning=false;this._oNavContainer=new sap.m.NavContainer(this.getId()+"-nav-container",{navigate:function(){t._bDetailPageIsTransitioning=true},afterNavigate:function(e){t._bDetailPageIsTransitioning=false;if(t._oDetailPage==e.getParameter("from")&&t._oMasterPage==e.getParameter("to")){var c=t._oNavContainer.getPages().length-1;for(var i=c-1;i>1;i--){t._oNavContainer.removeAggregation("pages",i,true)}}}});this.setAggregation("navContainer",this._oNavContainer);this._oActionSheet=new sap.m.ActionSheet(this.getId()+"-action-sheet",{showCancelButton:true,placement:sap.m.PlacementType.Top});this._oTransactionSheet=new sap.suite.ui.commons.LinkActionSheet(this.getId()+"-transaction-sheet",{showCancelButton:true,placement:sap.m.PlacementType.Top,itemPress:function(e){var i=e.getParameter("item");if(i.getMetadata().getName()=="sap.m.Link"&&i._bEnterWasPressed){t._bDontOpenTransactions=true}}});this._oKpiScrollCont=new sap.m.ScrollContainer(this.getId()+"-kpi-scroll-container",{width:"100%",horizontal:this.isPhone()});this._oKpiScrollCont.addStyleClass("sapSuiteUtiKpiBox");this._oFacetsGrid=new sap.ui.layout.Grid(this.getId()+"-facets-grid",{defaultSpan:"L6 M12 S12",hSpacing:1,vSpacing:1,width:"auto"});this._oFacetsGrid.addStyleClass("sapSuiteUtiFacetGrid");this._oHeader=this._createHeaderObject(this.getId()+"-header");this._oHeaderGrid=new sap.ui.layout.Grid(this.getId()+"-header-grid",{hSpacing:0,vSpacing:0,content:[this._oHeader,this._oKpiScrollCont]});this._oHeaderGrid.addStyleClass("sapSuiteUtiHeaderGrid");this._oMasterPage=new sap.m.Page(this.getId()+"-master-page",{content:[this._oHeaderGrid,this._oFacetsGrid],showNavButton:true,footer:new sap.m.Bar(this.getId()+"-master-footer",{contentLeft:[new sap.m.Button(this.getId()+"-master-settings-button",{icon:"sap-icon://action-settings",press:function(){var o={};o.caller=this;t.fireConfigurationButtonPress(o)}})],contentRight:[new sap.m.Button(this.getId()+"-master-action-button",{icon:"sap-icon://action",press:function(){var o={};o.caller=this;if(t.fireActionsButtonPress(o)){if(t._oActionSheet.getButtons().length){t._oActionSheet.openBy(this)}else{jQuery.sap.log.info("The are no actions for displaying")}}}})]}),navButtonPress:function(){t.fireBackAction()}});this._oMasterPage.getFooter().insertContentRight(new sap.m.Button(this.getId()+"-master-transaction-button",{text:t._rb.getText("UNIFIEDTHINGINSPECTOR_FOOTER_BUTTON_OPENWITH")+"...",press:function(){if(!t._bDontOpenTransactions){var o={};o.caller=this;if(t.fireTransactionsButtonPress(o)){if(t._oTransactionSheet.getItems().length){t._oTransactionSheet.openBy(this)}else{jQuery.sap.log.info("The are no transactions for displaying")}}}else{t._bDontOpenTransactions=false}}}),0);this._oDetailPage=new sap.m.Page(this.getId()+"-detail-page",{showNavButton:true,footer:new sap.m.Bar(this.getId()+"-detail-footer",{contentLeft:[new sap.m.Button(this.getId()+"-detail-settings-button",{icon:"sap-icon://action-settings",press:function(){var o={};o.caller=this;t.fireConfigurationButtonPress(o)}})],contentRight:[new sap.m.Button(this.getId()+"-detail-action-button",{icon:"sap-icon://action",press:function(){var o={};o.caller=this;if(t.fireActionsButtonPress(o)){if(t._oActionSheet.getButtons().length){t._oActionSheet.openBy(this)}else{jQuery.sap.log.info("The are no actions for displaying")}}}})]}),navButtonPress:function(){t._navigateToMaster()}});this._oDetailPage.getFooter().insertContentRight(new sap.m.Button(this.getId()+"-detail-transaction-button",{text:t._rb.getText("UNIFIEDTHINGINSPECTOR_FOOTER_BUTTON_OPENWITH")+"...",press:function(){var o={};o.caller=this;if(t.fireTransactionsButtonPress(o)){if(t._oTransactionSheet.getItems().length){t._oTransactionSheet.openBy(this)}else{jQuery.sap.log.info("The are no transactions for displaying")}}}}),0);this._oNavContainer.addPage(this._oMasterPage);this._oNavContainer.addPage(this._oDetailPage);if(!jQuery.device.is.desktop){sap.ui.Device.orientation.attachHandler(function(e){t._updateHeaderLayoutData(e)})}this.setModel=function(m,n){sap.suite.ui.commons.UnifiedThingInspector.prototype.setModel.apply(this,arguments);this._oActionSheet.setModel(m,n);this._oTransactionSheet.setModel(m,n);return this}};
sap.suite.ui.commons.UnifiedThingInspector.prototype.exit=function(){var t=this;this._oActionSheet.destroy();this._oTransactionSheet.destroy();sap.ui.Device.orientation.detachHandler(function(){t._updateHeaderLayoutData()});sap.ui.core.ResizeHandler.deregister(this._sTitleResizeHandlerId)};
sap.suite.ui.commons.UnifiedThingInspector.prototype._updateHeaderLayoutData=function(e){var w="";var c="";var k=this.getKpis().length;if(jQuery.device.is.tablet&&!e.landscape){w=100/k+"%";c="100%"}jQuery.sap.byId(this.getId()+"-kpi-scroll-container-scroll").find(".sapSuiteKTile").css("width",w);jQuery.sap.byId(this.getId()+"-kpi-scroll-container-scroll").css("width",c)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.onAfterRendering=function(){if(this._sTitleResizeHandlerId){sap.ui.core.ResizeHandler.deregister(this._sTitleResizeHandlerId)}if(this.getName()){var h=jQuery.sap.domById(this.getId()+"-header");this._sTitleResizeHandlerId=sap.ui.core.ResizeHandler.register(h,jQuery.proxy(this._handleResize,this))}if(jQuery.device.is.desktop){var f=this.getFacets();var F=0;var n=false;for(var i=0;i<f.length;i++){if(F>0){F-=f[i].getRowSpan()}else{if(n&&F==0){jQuery.sap.byId(f[i].getId()).parent().addClass("sapSuiteUtiFacetLeft");n=false}F+=f[i].getRowSpan()}if(f[i].getRowSpan()>1){n=true}}}if(jQuery.device.is.tablet&&jQuery.device.is.portrait){var k=this.getKpis().length;jQuery(".sapSuiteKTile").css("width",100/k+"%");jQuery.sap.byId(this.getId()+"-kpi-scroll-container-scroll").css("width","100%")}};
sap.suite.ui.commons.UnifiedThingInspector.prototype._handleResize=function(){var h=jQuery(jQuery.sap.domById(this.getId()+"-header-name"));var t=this._oHeader.getName().length;var w=h.width();h.css("font-size",this._getFontSize(t,w)+"px")};
sap.suite.ui.commons.UnifiedThingInspector.prototype._getFontSize=function(c,w){var n=w/(c*0.5);if(n>28){return 28}else if(n<20){return 20}else{return n}};
sap.suite.ui.commons.UnifiedThingInspector.prototype.onBeforeRendering=function(){sap.ui.getCore().byId(this.getId()+"-master-action-button").setVisible(this.getActionsVisible());sap.ui.getCore().byId(this.getId()+"-detail-action-button").setVisible(this.getActionsVisible());sap.ui.getCore().byId(this.getId()+"-master-transaction-button").setVisible(this.getTransactionsVisible());sap.ui.getCore().byId(this.getId()+"-detail-transaction-button").setVisible(this.getTransactionsVisible());this._oKpiScrollCont.setVisible(!!this.getKpis().length);if(this.getKpis().length<3){this._oKpiScrollCont.addStyleClass("sapSuiteUtiKpiLT3")}this._fitKpiTiles()};
sap.suite.ui.commons.UnifiedThingInspector.prototype._fitKpiTiles=function(){var h;var k;var K=this.getKpis().length;switch(K){case 0:h="L12 M12 S12";k="L12 M12 S12";break;case 1:h="L9 M12 S12";k="L3 M12 S12";break;case 2:h="L7 M12 S12";k="L5 M12 S12";break;default:h="L6 M12 S12";k="L6 M12 S12"}this._oHeader.setLayoutData(new sap.ui.layout.GridData({span:h}));this._oKpiScrollCont.setLayoutData(new sap.ui.layout.GridData({span:k}))};
sap.suite.ui.commons.UnifiedThingInspector.prototype.isPhone=function(){return jQuery.device.is.phone||jQuery.device.is.iphone};
sap.suite.ui.commons.UnifiedThingInspector.prototype.setTitle=function(t){this.setProperty("title",t,true);this._oMasterPage.setTitle(t);this._oDetailPage.setTitle(t)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.setName=function(n){this._oHeader.setName(n);this.setProperty("name",n,true)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.setDescription=function(d){this._oHeader.setDescription(d);this.setProperty("description",d,true)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.setIcon=function(i){this._oHeader.setIcon(i);this.setProperty("icon",i,true)};
sap.suite.ui.commons.UnifiedThingInspector.prototype._navigateToMaster=function(){this._oNavContainer.back()};
sap.suite.ui.commons.UnifiedThingInspector.prototype.navigateToDetailWithContent=function(f){if(!this._bDetailPageIsTransitioning){this.removeAllFacetContent();if(jQuery.isArray(f)){for(var i=0;i<f.length;i++){this.addFacetContent(f[i])}}else{this.addFacetContent(f)}this._oNavContainer.to(this._oDetailPage.getId());this._oDetailPage.scrollTo(0)}};
sap.suite.ui.commons.UnifiedThingInspector.prototype.navigateToDetail=function(){this._oNavContainer.to(this._oDetailPage.getId())};
sap.suite.ui.commons.UnifiedThingInspector.prototype.navigateToPage=function(p,a){var t=this;p.attachNavButtonPress(function(e){t._oNavContainer.back()});if(a==undefined||a){var f=this._oMasterPage.getFooter().clone();p.setFooter(f)}this._oNavContainer.addPage(p);this._oNavContainer.to(p.getId())};
sap.suite.ui.commons.UnifiedThingInspector.prototype.getActions=function(){return this._oActionSheet.getButtons()};
sap.suite.ui.commons.UnifiedThingInspector.prototype.insertAction=function(a,i){this._oActionSheet.insertButton(a,i);return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype.addAction=function(a){this._oActionSheet.addButton(a);return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype.removeAction=function(a){return this._oActionSheet.removeButton(a)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.removeAllActions=function(){return this._oActionSheet.removeAllButtons()};
sap.suite.ui.commons.UnifiedThingInspector.prototype.indexOfAction=function(a){return this._oActionSheet.indexOfButton(a)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.destroyActions=function(){this._oActionSheet.destroyButtons();return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype.getTransactions=function(){return this._oTransactionSheet.getItems()};
sap.suite.ui.commons.UnifiedThingInspector.prototype.addTransaction=function(t){this._oTransactionSheet.addItem(t);return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype.insertTransaction=function(t,i){this._oTransactionSheet.insertItem(t,i);return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype.removeTransaction=function(t){return this._oTransactionSheet.removeItem(t)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.removeAllTransactions=function(){return this._oTransactionSheet.removeAllItems()};
sap.suite.ui.commons.UnifiedThingInspector.prototype.indexOfTransaction=function(t){return this._oTransactionSheet.indexOfItem(t)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.destroyTransactions=function(){this._oTransactionSheet.destroyItems();return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype._callMethodInManagedObject=function(f,a){var b=Array.prototype.slice.call(arguments);if(a==="facets"){b[1]="content";return this._oFacetsGrid[f].apply(this._oFacetsGrid,b.slice(1))}else if(a==="kpis"){b[1]="content";return this._oKpiScrollCont[f].apply(this._oKpiScrollCont,b.slice(1))}else if(a==="facetContent"){b[1]="content";return this._oDetailPage[f].apply(this._oDetailPage,b.slice(1))}else{return sap.ui.base.ManagedObject.prototype[f].apply(this,b.slice(1))}};
sap.suite.ui.commons.UnifiedThingInspector.prototype.validateAggregation=function(a,o,m){return this._callMethodInManagedObject("validateAggregation",a,o,m)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.setAggregation=function(a,o,s){this._callMethodInManagedObject("setAggregation",a,o,s);return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype.getAggregation=function(a,d){return this._callMethodInManagedObject("getAggregation",a,d)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.indexOfAggregation=function(a,o){return this._callMethodInManagedObject("indexOfAggregation",a,o)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.insertAggregation=function(a,o,i,s){this._callMethodInManagedObject("insertAggregation",a,o,i,s);return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype.addAggregation=function(a,o,s){this._callMethodInManagedObject("addAggregation",a,o,s);return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype.removeAggregation=function(a,o,s){return this._callMethodInManagedObject("removeAggregation",a,o,s)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.removeAllAggregation=function(a,s){return this._callMethodInManagedObject("removeAllAggregation",a,s)};
sap.suite.ui.commons.UnifiedThingInspector.prototype.destroyAggregation=function(a,s){this._callMethodInManagedObject("destroyAggregation",a,s);return this};
sap.suite.ui.commons.UnifiedThingInspector.prototype._createHeaderObject=function(i){sap.ui.core.Control.extend("sap.suite.ui.commons.UnifiedThingInspector.Header",{metadata:{properties:{name:"string",description:"string",icon:"sap.ui.core.URI"}},setIcon:function(I){var v=!jQuery.sap.equal(this.getIcon(),I);if(v){if(this._oIcon){this._oIcon.destroy();this._oIcon=undefined}if(I){this._oIcon=sap.ui.core.IconPool.createControlByURI({id:this.getId()+"-icon-image",src:I},sap.m.Image);this._oIcon.addStyleClass("sapSuiteUtiHeaderIconImage");if(this._oIcon instanceof sap.ui.core.Icon){this._oIcon.setSize("64px")}}}return this.setProperty("icon",I)},exit:function(){if(this._oIcon){this._oIcon.destroy()}},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapSuiteUtiHeader");r.writeClasses();r.write(">");if(c._oIcon){r.write("<div");r.writeAttribute("id",c.getId()+"-icon");r.addClass("sapSuiteUtiHeaderIcon");r.writeClasses();r.write(">");r.renderControl(c._oIcon);r.write("</div>")}r.write("<div");r.writeAttribute("id",c.getId()+"-content");r.addClass("sapSuiteUtiHeaderContent");if(c._oIcon){r.addClass("sapSuiteUtiHeaderContentWithIcon")}else{r.addClass("sapSuiteUtiHeaderContent")}r.writeClasses();r.write(">");r.write("<div");r.writeAttribute("id",c.getId()+"-name");r.addClass("sapSuiteUtiHeaderName");r.writeClasses();r.write(">");r.writeEscaped(c.getName()?c.getName():"");r.write("</div>");r.write("<div");r.writeAttribute("id",c.getId()+"-description");r.addClass("sapSuiteUtiHeaderDesc");r.writeClasses();r.write(">");r.writeEscaped(c.getDescription()?c.getDescription():"");r.write("</div>");r.write("</div>");r.write("</div>")}});return new sap.suite.ui.commons.UnifiedThingInspector.Header(i)};
