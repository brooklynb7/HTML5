//Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ushell.ui.launchpad.GroupListItem");jQuery.sap.require("sap.ui.core.IconPool");var _=$.ui.sortable.prototype._mouseStop;$.ui.sortable.prototype._mouseStop=function(e,n){if(!e){return}if(this.options.revert){var t=this,a=arguments,c=t.placeholder.offset(),d=$.isFunction(this.options.revert)?this.options.revert.apply(this.element[0],[e,t._uiHash(this)]):this.options.revert,j=jQuery(this.helper);self.reverting=true;if(jQuery(".sapUshellDeleteArea_grouplist_functional").data("groupOver")===true){var g=sap.ui.getCore().byId(jQuery(t.currentItem).attr('id')),r=g.getRemovable(),R=sap.ushell.resources.i18n,D=R.getText(r?"delete_group_msg":"reset_group_msg",[j.find(".sapMSLITitleOnly").text()]),s=R.getText(r?"delete_group":"reset_group"),A=R.getText("okBtn"),b=R.getText("cancelBtn"),o=function(h){if(h===A){j.data("deleteMe",true);j.animate({top:(jQuery(document).height()-j.height()-10)+"px",left:"0px",opacity:0},!isNaN(d)?d:250,function(){t._clear(e)});var E=sap.ui.getCore().getEventBus();E.publish("launchpad",r?"deleteGroup":"resetGroup",{groupId:g.getGroupId()})}else if(h===b){j.data("deleteMe",false);j.animate({left:c.left-t.offset.parent.left-t.margins.left+(t.offsetParent[0]===document.body?0:t.offsetParent[0].scrollLeft),top:c.top-t.offset.parent.top-t.margins.top+(t.offsetParent[0]===document.body?0:t.offsetParent[0].scrollTop)},!isNaN(d)?d:250,function(){t._clear(e)})}jQuery(".sapUshellDeleteArea_grouplist_functional").data("groupOver",false)};g.bDeletionFlag=true;sap.ushell.services.Message.confirm(D,o,s,[A,b])}else if(jQuery(".sapUshellGroupList").data("dropGroup")){var f=jQuery.sap.byId(jQuery(".sapUshellGroupList").data("dropGroup").sId);j.animate({top:f.offset().top+16,left:f.offset().left+48,height:"0px",width:"0px",opacity:0},!isNaN(d)?d:250,function(){jQuery(".sapUshellGroupList").data("dropGroup",null);_.apply(t,a)})}else{_.apply(t,a)}}else{this._clear(e,n)}return false};sap.ui.jsview("sap.ushell.renderers.fiori2.launchpad.group_list.GroupList",{createContent:function(c){var t=this,o=this._getOpenCatalogItem(c),a=this._getAddGroupItem(c),g=this._getGroupListItemTemplate(c),n=undefined;this.oGrouplistDeleteArea=new sap.ushell.ui.launchpad.DeleteArea({type:sap.ushell.ui.launchpad.DeleteAreaType.GroupList});this.oGroupList=new sap.m.List({items:{path:"/groups",template:g}}).addStyleClass("sapUshellGroupItemList");var C=function(e){var l=e.getSource().oList;jQuery.each(l,function(b,i){if(i.editMode){var L=t.oGroupList.getItems();n=L[b].getId()}})};this.oGroupList.onAfterRendering=function(){c._updateGroupSelection();jQuery.proxy(c.makeSortable,c)();if(n){var j=jQuery.sap.byId(n);j.css('opacity',0).slideDown(300).animate({opacity:1},{queue:false,duration:300});n=undefined}this.getBinding("items").detachChange(C);this.getBinding("items").attachChange(C)};this.oGroupList.updateItems=sap.ushell.override.updateAggregatesFactory("items");this.oOpenCatalogList=new sap.m.List({mode:sap.m.ListMode.SingleSelectMaster,items:[o]});this.addStyleClass("sapUshellGroupList");if(!jQuery.device.is.phone){this.oAddGroupList=new sap.m.List({items:[a]}).addStyleClass("sapUshellAddGroupButton");return[this.oOpenCatalogList,this.oGroupList,this.oAddGroupList,this.oGrouplistDeleteArea]}else{return[this.oOpenCatalogList,this.oGroupList,this.oGrouplistDeleteArea]}},_getOpenCatalogItem:function(){var o=new sap.m.InputListItem({content:new sap.ui.core.Icon({src:'grid'}),label:"{i18n>open_catalog}"}).addStyleClass('sapUshellBrowseCatalogButton');o.attachBrowserEvent('click',function(){sap.ui.getCore().getEventBus().publish("openCatalog",{groupContext:null})});return o},_getGroupListItemTemplate:function(c){var o=function(e){jQuery.proxy(c._updateGroupSelection,c)();if(this.getParent().getItems()[0]===this){this.setAllowEditMode(false);this.addStyleClass("sapUshellOver");if(this.getDefaultGroup()){this.addStyleClass("sapUshellDefaultGroupItem")}}else{this.addStyleClass("sapUshellGroupListItem")}c._bindGroupListItemEvents(e)};return new sap.ushell.ui.launchpad.GroupListItem({title:"{title}",defaultGroup:"{isDefaultGroup}",groupId:"{groupId}",editMode:"{editMode}",removable:"{removable}",numberOfTiles:"{tiles/length}",afterRendering:o,press:[function(e){this._handleGroupListItemPress(e.getSource())},c],change:[c.onGroupTitleChange,c],over:[c._handleGroupListItemOver,c],out:[c._handleGroupListItemOut,c],drop:[c._handleGroupListItemDrop,c]})},_getAddGroupItem:function(c){return new sap.m.CustomListItem({content:new sap.ui.core.Icon({src:'sys-cancel'}),type:sap.m.ListType.Active,tooltip:"{i18n>addgroupBtn_tooltip}",press:[c._handleGroupCreate,c]}).addStyleClass("sapUshellAddTilesContainer")},getControllerName:function(){return"sap.ushell.renderers.fiori2.launchpad.group_list.GroupList"}})}());
