// Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";sap.ui.controller("sap.ushell.renderers.fiori2.launchpad.catalog.Catalog",{onInit:function(){var m=sap.ui.getCore().byId("navContainer").getModel();m.setProperty("/showCatalogHeaders",true);m.setProperty("/states/catalog/search",new sap.m.Text("catalogTitle",{text:"{i18n>tile_catalog}",width:"100%",textAlign:sap.ui.core.TextAlign.Center}).getId());sap.ui.getCore().getEventBus().subscribe("showCatalog",this.onShow,this)},onExit:function(){sap.ui.getCore().getEventBus().unsubscribe("showCatalog",this.onShow)},onAfterRendering:function(){sap.ui.getCore().byId("catalogSplitContainer").onswiperight=function(){}},onShow:function(c,e,d){$.extend(this.getView().getViewData(),d);var m=sap.ui.getCore().byId("navContainer").getModel(),C=m.getProperty("/catalogTiles")||[],i;for(i=0;i<C.length;i=i+1){C[i].active=false}this.applyTileFilters();window.setTimeout($.proxy(sap.ui.getCore().byId("catalogSelect").setSelectedItemId,sap.ui.getCore().byId("catalogSelect"),this.selectedCategory),500)},setCategoryFilter:function(f){this.categoryFilter=f||null;this.applyTileFilters()},setSearchFilter:function(f){this.searchFilter=f||null;this.applyTileFilters()},applyTileFilters:function(){var f=[],s,c;if(this.searchFilter){s=new sap.ui.model.Filter($.map(this.searchFilter.split(/[\s,]+/),function(v){return(v&&new sap.ui.model.Filter("keywords",sap.ui.model.FilterOperator.Contains,v))||undefined}),true);f.push(s)}if(this.categoryFilter){c=new sap.ui.model.Filter("catalog",sap.ui.model.FilterOperator.EQ,this.categoryFilter);f.push(c)}sap.ui.getCore().byId("catalogTiles").getBinding("tiles").filter(f)},onLiveFilter:function(e){var q=e.getParameter("newValue");if(q){this.setSearchFilter(q)}else{this.setSearchFilter()}},onCategoryFilter:function(e){var s=e.getParameter("selectedItem"),S=s.getBindingContext(),m=S.getModel();if(m.getProperty("static",S)){m.setProperty("/showCatalogHeaders",true);this.setCategoryFilter();this.selectedCategory=undefined}else{m.setProperty("/showCatalogHeaders",false);this.setCategoryFilter(s.getText());this.selectedCategory=s.getId()}},onTileDragStart:function(e){var s=sap.ui.getCore().byId("catalogTilesPage").getScrollDelegate()._scroller;if(s){window.setTimeout($.proxy(s.disable,s),1)}},onTileDragStop:function(e){var s=sap.ui.getCore().byId("catalogTilesPage").getScrollDelegate()._scroller;if(s){s.enable();s.scrollTo(0,0,1,true)}},onAddTileToDefault:function(e){var s=e.getSource().getBindingContext();if(!s.getProperty("active")){this._addTile(s,this.getView().getViewData().groupContext||new sap.ui.model.Context(s.getModel(),"/groups/0"))}},onAddTile:function(e){var s=e.getParameter("control").getBindingContext();if(!s.getProperty("active")){this._addTile(s,e.getSource().getBindingContext())}},_addTile:function(t,g){var b=sap.ui.getCore().getEventBus();window.setTimeout($.proxy(b.publish,b,"launchpad","addTile",{catalogTileContext:t,groupContext:g}),0)}})}());
