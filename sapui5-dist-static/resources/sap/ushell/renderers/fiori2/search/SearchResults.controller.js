// Copyright (c) 2013 SAP AG, All Rights Reserved
(function(){"use strict";jQuery.sap.require("sap.ushell.renderers.fiori2.search.SearchModel");sap.ui.controller("sap.ushell.renderers.fiori2.search.SearchResults",{onInit:function(){var s=this;this.requestID=10;this.top=10;try{var S=new sap.ushell.renderers.fiori2.search.SearchModel();this.getView().setModel(S);sap.ushell.Container.getService("Search").searchInit();sap.ushell.Container.getService("Search").searchFireQuery(this.getView().getModel());var b=this.getView().getModel().bindList("/results");b.attachChange(function(){s.getView().onResultItemsChanged()})}catch(e){jQuery.sap.log.error(e.name,e.message,"sap.ushell.renderers.fiori2.search.SearchResults");jQuery.sap.log.warning("Unable to initialize SearchModel","","sap.ushell.renderers.fiori2.search.SearchResults")}sap.ui.getCore().getEventBus().subscribe("search",this.searchInvoked,this);sap.ui.getCore().getEventBus().subscribe("selectCategory",function(c,E,d){s.category=d;s.getView().newSearchTriggered()},this);sap.ui.getCore().getEventBus().subscribe("searchFinished",function(c,E,r){s.getView().searchFinished(r)},this)},getCategory:function(){return this.category},onExit:function(){sap.ui.getCore().getEventBus().unsubscribe("search",this.searchInvoked,this);sap.ui.getCore().getEventBus().unsubscribe("selectCategory",this);sap.ui.getCore().getEventBus().unsubscribe("searchFinished",this)},getResultsForDataSource:function(d,r){var a=[];for(var i=0;i<r.length;i++){var b=r[i];var c=b.$$DataSourceMetaData$$;if(d.objectName.value===c.objectName.value){a.push(b)}}return a},gimmeSomeMore:function(){sap.ushell.Container.getService("Search").searchAppendNextPage(this.getView().getModel())},gimmeSearchTerm:function(){return this.searchTerm},loadResultset:function(s,d,a){var b=this;sap.ushell.Container.getService("Search").searchWithCategories(s,d,this.getView().getModel(),function(r){})},searchInvoked:function(c,e,d){var s,a=this,S=a.getView().getModel();a.category=d.dataSource;a.searchTerm=d.searchTerm;this.getView().newSearchTriggered();if(window.f2p){window.f2p.add(window.f2p.m.startSearch,{st:d.searchTerm})}this.loadResultset(d.searchTerm,d.dataSource,0);a.getView().getModel().setProperty("/tiles",[]);sap.ushell.Container.getService("Search").queryApplications(d.searchTerm,function(r){var m=[];var t=r.getElements();a.getView().getModel().setProperty("/tiles",t);a.getView().appSearchFinished(r)})},itemPressed:function(i){var m=this.getView().getModel();m.setProperty("/detail",i)}})}());
